[../scrum.pmo/roles/OntologyAgent/process.md](../../../scrum.pmo/roles/OntologyAgent/process.md)

# PDCA Cycle 9: Production Deployment Strategy

**Date**: 2025-01-27 UTC 15:30
**Role**: OntologyAgent  
**Task**: Implement alternative deployment strategy for main branch that avoids migration_backup creation

## Plan

### **Objective**
Deploy the dual-context architecture to the main branch without creating migration_backup directories or encountering "distinct types" merge conflicts.

### **Challenge Analysis**
The direct merge approach fails because:
1. **Main branch**: Files are regular files
2. **Feature branch**: Same paths are symlinks
3. **Git conflict**: "distinct types" - cannot merge file vs symlink
4. **Auto-creation**: Git automatically creates migration_backup during merge

### **Alternative Strategies Considered**

#### **Option 1: Reset and Force Push** ❌
- Reset main to feature branch state
- Force push to origin
- **Risk**: Loses main branch history

#### **Option 2: Manual File Conversion** ✅
- Stay on main branch
- Use maintenance scripts to convert files one by one
- Maintain git history
- No migration_backup directories

#### **Option 3: Create New Main Branch** ⚠️
- Rename current main to main-legacy
- Create new main from feature branch
- **Issue**: Requires repository settings change

### **Selected Strategy: Manual File Conversion**
Use the existing maintenance infrastructure to convert the main branch incrementally while preserving history.

## Do

### **Phase 1: Preparation**
1. Document the conversion process
2. Create deployment checklist
3. Prepare rollback strategy

### **Phase 2: Implementation Plan**
```bash
# 1. Create safe point on main
git checkout main
git pull origin main
git tag -a "pre-dual-context-deployment" -m "State before dual-context deployment"
git push --tags

# 2. Apply architecture changes
./maintenance/src/sh/03_architecture_migration.sh  # Modified to use git instead of backups

# 3. Fix page links
./maintenance/src/sh/04_fix_page_links.sh

# 4. Create dual entries
./maintenance/src/sh/05_create_dual_entries.sh  # Modified to use git recovery

# 5. Validate
./maintenance/src/sh/validate_links.sh --context both
```

### **Phase 3: Safety Modifications Needed**
Update maintenance scripts to use git-based safety:
1. `03_architecture_migration.sh` - Remove migration_backup creation
2. `05_create_dual_entries.sh` - Use git history instead of .migration.backup files

## Check

### **Pre-deployment Verification**
- [ ] All maintenance scripts updated for git-based safety
- [ ] Test scripts pass
- [ ] No migration_backup references remain
- [ ] Git hooks installed and working

### **Post-deployment Verification**
- [ ] All 29 dual entry points working
- [ ] Web navigation functional
- [ ] No backup files created
- [ ] Git history preserved

## Act

### **Implementation Steps**

#### **Step 1: Update Architecture Migration Script**
Remove migration_backup directory creation and use git tags instead.

#### **Step 2: Update Dual Entries Script**
Modify to read from git history instead of .migration.backup files.

#### **Step 3: Create Deployment Guide**
Document the exact commands and verification steps.

#### **Step 4: Execute Deployment**
Follow the deployment guide with careful verification at each step.

### **Rollback Plan**
```bash
# If anything goes wrong:
git reset --hard pre-dual-context-deployment
git clean -fd
```

### **Success Criteria**
1. ✅ Main branch has dual-context architecture
2. ✅ No migration_backup directories created
3. ✅ Git history preserved
4. ✅ Web navigation working from GitHub

---

## Summary

**Strategy**: Manual conversion on main branch using updated maintenance scripts
**Key Innovation**: Git-based safety instead of backup files
**Risk Mitigation**: Tagged safe points and tested rollback procedures
**Timeline**: Ready for execution after script updates